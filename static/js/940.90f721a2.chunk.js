"use strict";(self.webpackChunksocial_network=self.webpackChunksocial_network||[]).push([[940],{940:function(e,n,t){t.r(n),t.d(n,{default:function(){return D}});var r=t(2791),s=t(9439),a=t(9900),o=t(5021),i=t(653),u=t(3044),c=t(493),l=t(890),f=t(4721),d=t(8687),v=t(184),m=r.memo((function(e){var n=e.message;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(o.ZP,{children:[(0,v.jsx)(i.Z,{children:(0,v.jsx)(u.Z,{alt:n.userName,src:n.photo})}),(0,v.jsx)(a.Z,{primary:n.userName,secondary:(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(l.Z,{component:"span",variant:"body2",color:"text.primary",children:n.message})})})]}),(0,v.jsx)(f.Z,{variant:"inset",component:"li"})]})})),h=function(){var e=(0,d.v9)((function(e){return e.chatReducer.messages})),n=(0,r.useRef)(null),t=(0,r.useState)(!0),a=(0,s.Z)(t,2),o=a[0],i=a[1];return(0,r.useEffect)((function(){var e;o&&(null===(e=n.current)||void 0===e||e.scrollIntoView(!0))}),[e]),(0,v.jsx)("div",{style:{height:"400px",overflowY:"auto",marginBottom:"50px"},onScroll:function(e){var n=e.currentTarget;n.scrollHeight-n.scrollTop===n.clientHeight?!o&&i(!0):o&&i(!1)},children:(0,v.jsxs)(c.Z,{children:[e.map((function(e,n){return(0,v.jsx)(m,{message:e},n)})),(0,v.jsx)("div",{ref:n})]})})},g=t(6151),p=t(4554),x=t(1686),Z=t(2506),j=t(7491),w=t(7460),y=t(4165),E=t(5861),I=t(700),S=t(3585),L={"messages-received":[],"status-changed":[]},k=null,F=function(){console.log("close ws"),C("pending"),setTimeout(M,3e3)},R=function(e){var n=JSON.parse(e.data);L["messages-received"].forEach((function(e){return e(n)}))},b=function(){C("ready")},N=function(){C("error"),console.error("REFRESH PAGE")},A=function(){var e,n,t,r;null===(e=k)||void 0===e||e.removeEventListener("close",F),null===(n=k)||void 0===n||n.removeEventListener("message",R),null===(t=k)||void 0===t||t.removeEventListener("open",b),null===(r=k)||void 0===r||r.removeEventListener("error",N)},C=function(e){L["status-changed"].forEach((function(n){n(e)}))},M=function(){var e,n,t,r,s;A(),null===(e=k)||void 0===e||e.close(),k=new WebSocket(S.Lf),C("pending"),null===(n=k)||void 0===n||n.addEventListener("close",F),null===(t=k)||void 0===t||t.addEventListener("message",R),null===(r=k)||void 0===r||r.addEventListener("open",b),null===(s=k)||void 0===s||s.addEventListener("error",N)},P=function(){M()},T=function(){var e;L["messages-received"]=[],L["status-changed"]=[],A(),null===(e=k)||void 0===e||e.close()},H=function(e,n){return L[e].push(n),function(){L[e]=L[e].filter((function(e){return e!==n}))}},_=function(e,n){L[e]=L[e].filter((function(e){return e!==n}))},B=function(e){var n;null===(n=k)||void 0===n||n.send(e)},G=null,J=null,O=function(e){return null===G&&(G=function(n){e(W(n))}),G},V=function(e){return null===J&&(J=function(n){e(Y(n))}),J},W=function(e){return{type:I.j,payload:e}},Y=function(e){return{type:I._,payload:e}},q=function(){var e=(0,d.I0)(),n=(0,d.v9)((function(e){return e.chatReducer.status}));return(0,v.jsx)(Z.J9,{initialValues:{message:""},onSubmit:function(n,t){var r,s=t.resetForm;n.message&&(e((r=n.message,function(){var e=(0,E.Z)((0,y.Z)().mark((function e(n){return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:B(r);case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())),s())},validationSchema:j.Fh,validateOnBlur:!0,children:function(e){e.values,e.handleChange;var t=e.errors,r=e.touched,s=e.dirty;return(0,v.jsxs)(Z.l0,{children:[(0,w.Gr)("message",null,r,t,"text","medium",!1,"Enter your message","filled",!0),(0,v.jsx)(p.Z,{mt:2,children:(0,v.jsx)(g.Z,{variant:"contained",type:"submit",endIcon:(0,v.jsx)(x.Z,{}),disabled:!s||!!t.message||"ready"!==n,children:"Send"})})]})}})},z=function(){var e=(0,d.I0)(),n=(0,d.v9)((function(e){return e.chatReducer.status}));return(0,r.useEffect)((function(){return e(function(){var e=(0,E.Z)((0,y.Z)().mark((function e(n){return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:P(),H("messages-received",O(n)),H("status-changed",V(n));case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),function(){e(function(){var e=(0,E.Z)((0,y.Z)().mark((function e(n){return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:_("messages-received",O(n)),_("status-changed",V(n)),T();case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())}}),[]),(0,v.jsxs)(v.Fragment,{children:["error"===n&&(0,v.jsx)("p",{children:"Some error occured. Please refresh the page"}),(0,v.jsx)(h,{}),(0,v.jsx)(q,{})]})},D=function(){return(0,v.jsx)(z,{})}},653:function(e,n,t){t.d(n,{Z:function(){return p}});var r=t(3366),s=t(7462),a=t(2791),o=t(8182),i=t(4419),u=t(6199),c=t(6934),l=t(1402),f=t(5878),d=t(1217);function v(e){return(0,d.Z)("MuiListItemAvatar",e)}(0,f.Z)("MuiListItemAvatar",["root","alignItemsFlexStart"]);var m=t(184),h=["className"],g=(0,c.ZP)("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:function(e,n){var t=e.ownerState;return[n.root,"flex-start"===t.alignItems&&n.alignItemsFlexStart]}})((function(e){var n=e.ownerState;return(0,s.Z)({minWidth:56,flexShrink:0},"flex-start"===n.alignItems&&{marginTop:8})})),p=a.forwardRef((function(e,n){var t=(0,l.Z)({props:e,name:"MuiListItemAvatar"}),c=t.className,f=(0,r.Z)(t,h),d=a.useContext(u.Z),p=(0,s.Z)({},t,{alignItems:d.alignItems}),x=function(e){var n=e.alignItems,t=e.classes,r={root:["root","flex-start"===n&&"alignItemsFlexStart"]};return(0,i.Z)(r,v,t)}(p);return(0,m.jsx)(g,(0,s.Z)({className:(0,o.Z)(x.root,c),ownerState:p,ref:n},f))}))}}]);
//# sourceMappingURL=940.90f721a2.chunk.js.map